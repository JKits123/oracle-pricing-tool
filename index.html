<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oracle Smart Pricing Tool - Current Development Limited</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="wizard-header">
            <div class="logo-section">
                <img src="company-logo.png" alt="Current Development Limited" class="company-logo">
                <div class="tool-title">
                    <h1>Oracle Smart Pricing Tool</h1>
                    <p>Intelligent Air Conditioning System Pricing</p>
                </div>
            </div>
        </header>

        <main class="wizard-main">
            <div class="wizard-container">
                <div class="wizard-header-section">
                    <h2>Project Configuration Wizard</h2>
                    <p>Answer a few questions to get an intelligent, pre-configured quote</p>
                </div>

                <form id="projectWizard" class="wizard-form">
                    
                    <!-- Step 1: Customer Information -->
                    <div class="wizard-step active" id="step1">
                        <div class="step-header">
                            <span class="step-number">1</span>
                            <h3>Customer Information</h3>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="customerName">Customer Name *</label>
                                <input type="text" id="customerName" name="customerName" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="projectName">Project Name</label>
                                <input type="text" id="projectName" name="projectName" placeholder="e.g., Office Air Con Installation">
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="customerAddress">Installation Address *</label>
                                <textarea id="customerAddress" name="customerAddress" rows="3" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="contactPhone">Contact Phone</label>
                                <input type="tel" id="contactPhone" name="contactPhone">
                            </div>
                            
                            <div class="form-group">
                                <label for="contactEmail">Contact Email</label>
                                <input type="email" id="contactEmail" name="contactEmail">
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Project Type & Requirements -->
                    <div class="wizard-step" id="step2">
                        <div class="step-header">
                            <span class="step-number">2</span>
                            <h3>Project Requirements</h3>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="projectType">Project Type *</label>
                                <select id="projectType" name="projectType" required>
                                    <option value="">Select project type...</option>
                                    <option value="domestic">Domestic Installation</option>
                                    <option value="commercial">Commercial Installation</option>
                                    <option value="mixed">Mixed Use</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="capacityRequired">Cooling Capacity Required (kW) *</label>
                                <select id="capacityRequired" name="capacityRequired" required>
                                    <option value="">Select capacity...</option>
                                    <option value="2.5">2.5kW (Small room/office)</option>
                                    <option value="3.5">3.5kW (Medium room/office)</option>
                                    <option value="5.0">5.0kW (Large room/small office)</option>
                                    <option value="6.0">6.0kW (Large room/medium office)</option>
                                    <option value="7.1">7.1kW (Very large room/office)</option>
                                    <option value="9.0">9.0kW (Small commercial space)</option>
                                    <option value="10.0">10.0kW (Medium commercial space)</option>
                                    <option value="12.0">12.0kW (Large commercial space)</option>
                                    <option value="14.0">14.0kW (Very large commercial)</option>
                                    <option value="16.0">16.0kW (Industrial application)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="indoorUnitType">Indoor Unit Type *</label>
                                <select id="indoorUnitType" name="indoorUnitType" required>
                                    <option value="">Select unit type...</option>
                                    <option value="wall">Wall Mounted Split</option>
                                    <option value="floor">Floor Standing</option>
                                    <option value="ceiling-cassette">Ceiling Cassette (4-way)</option>
                                    <option value="ceiling-ducted">Ceiling Ducted</option>
                                    <option value="multi-split">Multi-Split System</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="manufacturerPreference">Manufacturer Preference</label>
                                <select id="manufacturerPreference" name="manufacturerPreference">
                                    <option value="any">Any Manufacturer (Best Value)</option>
                                    <option value="mitsubishi">Mitsubishi Electric Preferred</option>
                                    <option value="daikin">Daikin Preferred</option>
                                    <option value="fujitsu">Fujitsu Preferred</option>
                                    <option value="mhi">MHI Preferred</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="pipeRunDistance">Pipe Run Distance (meters) *</label>
                                <select id="pipeRunDistance" name="pipeRunDistance" required>
                                    <option value="">Select distance...</option>
                                    <option value="5">Up to 5m (Very short run)</option>
                                    <option value="10">5-10m (Short run)</option>
                                    <option value="15">10-15m (Medium run)</option>
                                    <option value="20">15-20m (Long run)</option>
                                    <option value="25">20-25m (Very long run)</option>
                                    <option value="30">25-30m (Extended run)</option>
                                    <option value="40">30-40m (Commercial long run)</option>
                                    <option value="50">40-50m (Maximum run)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="installationDifficulty">Installation Complexity</label>
                                <select id="installationDifficulty" name="installationDifficulty">
                                    <option value="standard">Standard (Easy access, ground floor)</option>
                                    <option value="moderate">Moderate (Some height work, normal access)</option>
                                    <option value="difficult">Difficult (High access, tight spaces)</option>
                                    <option value="complex">Complex (Specialist access, multiple obstacles)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Site Conditions -->
                    <div class="wizard-step" id="step3">
                        <div class="step-header">
                            <span class="step-number">3</span>
                            <h3>Site Conditions & Requirements</h3>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="drainageOption">Condensate Drainage</label>
                                <select id="drainageOption" name="drainageOption">
                                    <option value="gravity">Gravity drainage (downhill to outside)</option>
                                    <option value="pump-required">Condensate pump required</option>
                                    <option value="external-only">External drainage only</option>
                                    <option value="assessment-needed">Assessment required</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="accessEquipment">Access Equipment Required</label>
                                <select id="accessEquipment" name="accessEquipment">
                                    <option value="none">No special access required</option>
                                    <option value="ladders">Extension ladders sufficient</option>
                                    <option value="scaffold">Mobile scaffold required</option>
                                    <option value="cherry-picker">Cherry picker required</option>
                                    <option value="specialist">Specialist access required</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="coreHoles">Core Drilling Required</label>
                                <select id="coreHoles" name="coreHoles">
                                    <option value="none">No core drilling</option>
                                    <option value="small">1-2 small holes (110mm)</option>
                                    <option value="medium">2-3 medium holes (150mm)</option>
                                    <option value="large">Large holes or multiple (200mm+)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="workingHours">Preferred Working Hours</label>
                                <select id="workingHours" name="workingHours">
                                    <option value="standard">Standard hours (8am-5pm)</option>
                                    <option value="early">Early start required</option>
                                    <option value="evening">Evening work required</option>
                                    <option value="weekend">Weekend work required</option>
                                    <option value="out-of-hours">Out of hours premium</option>
                                </select>
                            </div>
                            
                            <div class="form-group full-width">
                                <label>Documentation Required</label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="documentation" value="method-statement">
                                        Method Statement
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="documentation" value="risk-assessment">
                                        Risk Assessment
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="documentation" value="permit-to-work">
                                        Permit to Work
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="documentation" value="hot-works">
                                        Hot Works Permit
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="additionalNotes">Additional Notes / Special Requirements</label>
                                <textarea id="additionalNotes" name="additionalNotes" rows="4" placeholder="Any specific requirements, constraints, or notes about the installation..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="wizard-navigation">
                        <button type="button" id="prevBtn" class="nav-btn secondary" style="display: none;">‚Üê Previous</button>
                        <button type="button" id="nextBtn" class="nav-btn primary">Next ‚Üí</button>
                        <button type="submit" id="generateQuote" class="nav-btn success" style="display: none;">Generate Intelligent Quote ‚Üí</button>
                    </div>

                    <!-- Progress Indicator -->
                    <div class="progress-indicator">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-steps">
                            <span class="progress-step active">Customer Info</span>
                            <span class="progress-step">Requirements</span>
                            <span class="progress-step">Site Conditions</span>
                        </div>
                    </div>
                </form>

                <!-- System Intelligence Preview -->
                <div class="intelligence-preview" id="intelligencePreview" style="display: none;">
                    <h3>üß† System Intelligence Preview</h3>
                    <div class="preview-content">
                        <div class="preview-section">
                            <h4>Recommended Equipment:</h4>
                            <p id="equipmentPreview">Select capacity and unit type to see recommendations...</p>
                        </div>
                        <div class="preview-section">
                            <h4>Pipe Sizing:</h4>
                            <p id="pipeSizingPreview">Select capacity to see pipe size recommendations...</p>
                        </div>
                        <div class="preview-section">
                            <h4>Estimated Cable Tray:</h4>
                            <p id="cableTrayPreview">Select pipe run distance for tray calculations...</p>
                        </div>
                        <div class="preview-section">
                            <h4>Pre-Selected Materials:</h4>
                            <p id="materialsPreview">Materials will be automatically calculated...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="scripts.js"></script>
    <script>
        // Wizard functionality - Fixed refresh hanging issue
        let currentStep = 1;
        const totalSteps = 3;

        document.addEventListener('DOMContentLoaded', function() {
            initializeWizard();
        });

        function initializeWizard() {
            // Add event listeners for intelligent previews - Fixed to prevent page refresh
            const selects = ['capacityRequired', 'indoorUnitType', 'pipeRunDistance', 'projectType', 'manufacturerPreference'];
            selects.forEach(selectId => {
                const element = document.getElementById(selectId);
                if (element) {
                    element.addEventListener('change', function(e) {
                        e.preventDefault();
                        updateIntelligencePreview();
                    });
                }
            });
            
            // Navigation event listeners
            document.getElementById('nextBtn').addEventListener('click', function(e) {
                e.preventDefault();
                nextStep();
            });
            document.getElementById('prevBtn').addEventListener('click', function(e) {
                e.preventDefault();
                prevStep();
            });
            document.getElementById('generateQuote').addEventListener('click', function(e) {
                e.preventDefault();
                generateQuote();
            });
            
            updateProgressBar();
        }

        function nextStep() {
            if (validateCurrentStep()) {
                if (currentStep < totalSteps) {
                    // Hide current step
                    document.getElementById(`step${currentStep}`).classList.remove('active');
                    
                    // Show next step
                    currentStep++;
                    document.getElementById(`step${currentStep}`).classList.add('active');
                    
                    updateNavigation();
                    updateProgressBar();
                    
                    // Show intelligence preview on final step
                    if (currentStep === totalSteps) {
                        document.getElementById('intelligencePreview').style.display = 'block';
                        updateIntelligencePreview();
                    }
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                // Hide current step
                document.getElementById(`step${currentStep}`).classList.remove('active');
                
                // Show previous step
                currentStep--;
                document.getElementById(`step${currentStep}`).classList.add('active');
                
                updateNavigation();
                updateProgressBar();
                
                // Hide intelligence preview
                if (currentStep < totalSteps) {
                    document.getElementById('intelligencePreview').style.display = 'none';
                }
            }
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const generateBtn = document.getElementById('generateQuote');
            
            // Show/hide previous button
            prevBtn.style.display = currentStep > 1 ? 'block' : 'none';
            
            // Show/hide next vs generate button
            if (currentStep === totalSteps) {
                nextBtn.style.display = 'none';
                generateBtn.style.display = 'block';
            } else {
                nextBtn.style.display = 'block';
                generateBtn.style.display = 'none';
            }
        }

        function updateProgressBar() {
            const progressFill = document.getElementById('progressFill');
            const progressSteps = document.querySelectorAll('.progress-step');
            
            // Update progress bar
            const progressPercent = (currentStep / totalSteps) * 100;
            progressFill.style.width = progressPercent + '%';
            
            // Update step indicators
            progressSteps.forEach((step, index) => {
                if (index < currentStep) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
        }

        function validateCurrentStep() {
            const currentStepElement = document.getElementById(`step${currentStep}`);
            const requiredFields = currentStepElement.querySelectorAll('[required]');
            
            let isValid = true;
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('error');
                    isValid = false;
                } else {
                    field.classList.remove('error');
                }
            });
            
            if (!isValid) {
                alert('Please fill in all required fields before continuing.');
            }
            
            return isValid;
        }

        function updateIntelligencePreview() {
            const capacity = document.getElementById('capacityRequired').value;
            const unitType = document.getElementById('indoorUnitType').value;
            const pipeDistance = document.getElementById('pipeRunDistance').value;
            const projectType = document.getElementById('projectType').value;
            const manufacturerPref = document.getElementById('manufacturerPreference').value;
            
            updateEquipmentRecommendations(capacity, unitType, projectType, manufacturerPref);
            updatePipeSizing(capacity);
            updateCableTrayCalculation(pipeDistance);
            updateMaterialsPreview(capacity, pipeDistance, unitType);
        }

        function updateEquipmentRecommendations(capacity, unitType, projectType, manufacturerPref) {
            const preview = document.getElementById('equipmentPreview');
            
            if (!capacity || !unitType) {
                preview.textContent = 'Select capacity and unit type to see recommendations...';
                return;
            }
            
            let recommendations = [];
            const cap = parseFloat(capacity);
            
            // Smart filtering based on manufacturer preference
            if (manufacturerPref === 'mitsubishi') {
                if (cap <= 9.0 && (projectType === 'domestic' || unitType === 'wall')) {
                    recommendations.push('Mitsubishi M Series');
                }
                if (cap >= 2.5) {
                    recommendations.push('Mitsubishi Mr Slim');
                }
            } else if (manufacturerPref === 'daikin') {
                if (cap <= 7.1 && (projectType === 'domestic' || unitType === 'wall')) {
                    recommendations.push('Daikin Standard Range');
                }
                if (cap >= 3.5) {
                    recommendations.push('Daikin Sky Air');
                }
            } else if (manufacturerPref === 'fujitsu') {
                if (cap <= 9.0 && (projectType === 'domestic' || unitType === 'wall')) {
                    recommendations.push('Fujitsu Split Systems');
                }
                if (cap >= 10.0) {
                    recommendations.push('Fujitsu Air Stage');
                }
            } else if (manufacturerPref === 'mhi') {
                if (cap <= 7.1) {
                    recommendations.push('MHI RAC');
                }
                if (cap >= 5.0) {
                    recommendations.push('MHI PAC');
                }
            } else {
                // Any manufacturer - show best options
                if (cap <= 7.1 && (projectType === 'domestic' || unitType === 'wall')) {
                    recommendations.push('M Series', 'Standard Range', 'Split Systems');
                }
                if (cap >= 5.0 && (projectType === 'commercial' || unitType === 'ceiling-cassette')) {
                    recommendations.push('Mr Slim', 'Sky Air', 'PAC');
                }
                if (cap >= 10.0) {
                    recommendations.push('Air Stage', 'Sky Air', 'PAC');
                }
            }
            
            // Filter out incompatible unit types
            if (unitType === 'ceiling-cassette') {
                recommendations = recommendations.filter(r => !r.includes('M Series') && !r.includes('Split Systems'));
            }
            
            preview.textContent = recommendations.length > 0 ? 
                `Will show: ${recommendations.join(', ')} at ${capacity}kW` : 
                'No suitable equipment for this combination';
        }

        function updatePipeSizing(capacity) {
            const preview = document.getElementById('pipeSizingPreview');
            
            if (!capacity) {
                preview.textContent = 'Select capacity to see pipe size recommendations...';
                return;
            }
            
            const cap = parseFloat(capacity);
            let liquidPipe, gasPipe, maxRun;
            
            if (cap <= 3.5) {
                liquidPipe = '1/4"';
                gasPipe = '3/8"';
                maxRun = '20m';
            } else if (cap <= 5.0) {
                liquidPipe = '1/4"';
                gasPipe = '1/2"';
                maxRun = '30m';
            } else if (cap <= 7.1) {
                liquidPipe = '3/8"';
                gasPipe = '5/8"';
                maxRun = '40m';
            } else if (cap <= 10.0) {
                liquidPipe = '3/8"';
                gasPipe = '3/4"';
                maxRun = '45m';
            } else {
                liquidPipe = '1/2"';
                gasPipe = '7/8"';
                maxRun = '50m';
            }
            
            preview.textContent = `Auto-selected: ${liquidPipe} √ó ${gasPipe} pre-insulated set (Max: ${maxRun})`;
        }

        function updateCableTrayCalculation(pipeDistance) {
            const preview = document.getElementById('cableTrayPreview');
            
            if (!pipeDistance) {
                preview.textContent = 'Select pipe run distance for tray calculations...';
                return;
            }
            
            const distance = parseInt(pipeDistance);
            const allowance = 5; // 2.5m each end
            const totalDistance = distance + allowance;
            const trayLengths = Math.ceil(totalDistance / 3); // 3m tray lengths
            
            preview.textContent = `Auto-calculated: ${trayLengths} √ó 3m cable tray lengths`;
        }

        function updateMaterialsPreview(capacity, pipeDistance, unitType) {
            const preview = document.getElementById('materialsPreview');
            
            if (!capacity || !pipeDistance) {
                preview.textContent = 'Materials will be automatically calculated...';
                return;
            }
            
            let materials = [];
            
            // Pipe set
            const cap = parseFloat(capacity);
            if (cap <= 3.5) materials.push('1/4" √ó 3/8" pipe set');
            else if (cap <= 5.0) materials.push('1/4" √ó 1/2" pipe set');
            else if (cap <= 7.1) materials.push('3/8" √ó 5/8" pipe set');
            else if (cap <= 10.0) materials.push('3/8" √ó 3/4" pipe set');
            else materials.push('1/2" √ó 7/8" pipe set');
            
            // Cable tray
            const distance = parseInt(pipeDistance);
            const trayLengths = Math.ceil((distance + 5) / 3);
            materials.push(`${trayLengths} √ó cable tray lengths`);
            
            // Unit-specific materials
            if (unitType === 'ceiling-cassette') {
                materials.push('Cassette suspension kit', 'Threaded studding', 'Uni-Strut');
            } else if (unitType === 'wall') {
                materials.push('Wall mounting brackets');
            }
            
            // Drainage
            materials.push('Condensate drainage', 'P-trap kit');
            
            preview.textContent = `Pre-selected: ${materials.join(', ')}`;
        }

        function generateQuote() {
            if (validateCurrentStep()) {
                // Collect all form data
                const formData = new FormData(document.getElementById('projectWizard'));
                const projectData = {};
                
                // Convert FormData to object
                for (let [key, value] of formData.entries()) {
                    if (projectData[key]) {
                        // Handle multiple values (like checkboxes)
                        if (Array.isArray(projectData[key])) {
                            projectData[key].push(value);
                        } else {
                            projectData[key] = [projectData[key], value];
                        }
                    } else {
                        projectData[key] = value;
                    }
                }
                
                // Store project data globally
                window.projectData = projectData;
                // Store project data in sessionStorage for persistence
                sessionStorage.setItem('oracleProjectData', JSON.stringify(projectData));
                // Store intelligence data for equipment filtering
                const.intelligenceData = {
                    capacity: parseFloat(projectData.capacityRequired),
                    unitType: projectData.indoorUnitType,
                    pipeDistance: parseInt(projectData.pipeRunDistance),
                    projectType: projectData.projectType,
                    manufacturerPref: projectData.manufacturerPreference,
                    complexity: projectData.installationDifficulty,
                    drainageOption: projectData.drainageOption,
                    accessEquipment: projectData.accessEquipment,
                    coreHoles: projectData.coreHoles
                };
                sessionStorage.setItem('oracleIntelligenceData', JSON.stringify(intelligenceData));
                // Show loading state
                document.getElementById('generateQuote').textContent = 'Generating Intelligent Quote...';
                document.getElementById('generateQuote').disabled = true;
                
                // Simulate processing time then redirect
                setTimeout(() => {
                    window.location.href = 'equipment.html';
                }, 1500);
            }
        }
    </script>
</body>
</html>
